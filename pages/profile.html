<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard - All Articles</title>

  <link rel="stylesheet" href="../asset/css/dashboard.css">

  <!-- Bootstrap + Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>
<style>
    .pro-wrap{
  border-radius: 22px;
  background:
    radial-gradient(900px 520px at 35% 18%, rgba(255,255,255,.55) 0%, rgba(255,255,255,0) 65%),
    linear-gradient(180deg, rgba(255,255,255,.40), rgba(255,255,255,.24));
  border: 1px solid rgba(255,255,255,.55);
  box-shadow: 0 16px 42px rgba(20,30,40,.10);
  padding: 18px;
}

.pro-card{
  border-radius: 18px;
  background: rgba(255,255,255,.78);
  border: 1px solid rgba(255,255,255,.78);
  box-shadow: 0 14px 34px rgba(20,30,40,.10);
  padding: 18px;
}

.pro-top{
  display:flex;
  align-items:center;
  gap:18px;
  justify-content:space-between;
  flex-wrap:wrap;
  padding-bottom: 16px;
  border-bottom: 1px solid rgba(31,42,51,.08);
  margin-bottom: 16px;
}

/* ===== Avatar Wrapper (IMPORTANT FIX) ===== */
.pro-avatar-wrap{
  position: relative;
  width: 110px;
  height: 110px;
  flex: 0 0 auto;
}

/* avatar */
.pro-avatar{
  width: 110px;
  height: 110px;
  border-radius: 50%;
  background: rgba(31,42,51,.08);
  border: 6px solid rgba(255,255,255,.9);
  box-shadow: 0 18px 40px rgba(20,30,40,.12);
  overflow:hidden;
}

.pro-avatar img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}

/* ===== ICON STYLE ===== */
.pro-ic{
  position:absolute;
  width: 38px;
  height: 38px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.85);
  display:grid;
  place-items:center;
  box-shadow: 0 14px 28px rgba(20,30,40,.14);
  backdrop-filter: blur(10px);
  cursor:pointer;
  transition: transform .15s ease, filter .15s ease;
}

.pro-ic:hover{
  transform: translateY(-2px);
  filter: brightness(1.02);
}

/* ðŸ‘‰ move OUTSIDE avatar */
.pro-del{
  left: -14px;
  bottom: 8px;
  background: rgba(229,57,53,.92);
  color:#fff;
}

.pro-up{
  right: -14px;
  bottom: 8px;
  background: rgba(31,42,51,.92);
  color:#fff;
}

/* identity */
.pro-id{
  flex: 1 1 360px;
  min-width: 240px;
}

.pro-name{
  margin:0;
  font-weight: 900;
  letter-spacing:.2px;
  font-size: 2rem;
}

.pro-email{
  color: rgba(31,42,51,.55);
  font-weight: 800;
  margin-top: 2px;
}

.pro-hint{
  color: rgba(31,42,51,.45);
  font-weight: 700;
  margin-top: 4px;
  font-size: .95rem;
}

/* buttons */
.pro-actions{ margin-left:auto; }

.pro-btn{
  border:0;
  color:#fff !important;
  font-weight: 900;
  border-radius: 14px;
  padding: 10px 14px;
  background: linear-gradient(135deg, rgba(31,42,51,.92), rgba(31,42,51,.82));
  box-shadow: 0 12px 22px rgba(20,30,40,.14);
  transition: transform .18s ease, filter .18s ease;
  white-space: nowrap;
}

.pro-btn:hover{
  filter: brightness(1.03);
  transform: translateY(-1px);
}

.pro-btn-save{
  border:0;
  color:#fff !important;
  font-weight: 900;
  border-radius: 14px;
  padding: 10px 14px;
  background: linear-gradient(135deg, rgba(24,182,182,.95), rgba(88,108,255,.90));
  box-shadow: 0 12px 22px rgba(24,182,182,.22);
}

/* form inputs */
.formP{
  border-radius: 12px;
  padding: 12px 14px;
  font-weight: 800;
  background: rgba(31,42,51,.06);
  border: 1px solid rgba(31,42,51,.10);
}

.formP:disabled{
  color: rgba(31,42,51,.70);
}

.formP.is-edit{
  background: rgba(255,255,255,.90);
  border: 1.6px solid rgba(31,42,51,.14);
}

.formP.is-edit:focus{
  border-color: rgba(24,182,182,.55);
  box-shadow: 0 0 0 .22rem rgba(24,182,182,.14);
}

.pro-form-actions{
  display:flex;
  justify-content:flex-end;
  gap:10px;
  margin-top: 16px;
  padding-top: 14px;
  border-top: 1px solid rgba(31,42,51,.08);
  flex-wrap:wrap;
}

/* responsive */
@media (max-width: 992px){
  .pro-name{ font-size: 1.6rem; }
  .pro-actions{ width:100%; }
  .pro-btn{ width:100%; display:flex; justify-content:center; }
}


</style>
<body>
  <div class="backdrop" id="backdrop"></div>

  <div class="app">

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <div class="logo"><i class="bi bi-person-fill"></i></div>
        <div><h5>Admin</h5></div>
      </div>

      <div class="menu-title">MENU</div>

      <nav class="d-grid gap-2">

        <a class="nav-pill" href="dashboard.html">
          <span class="ic"><i class="bi bi-speedometer2"></i></span>
          <span class="label flex-grow-1">Dashboard</span>
        </a>

        <!-- My Articles (collapsible) -->
        <button
          class="nav-pill w-100 text-start "
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#articlesMenu"
          aria-expanded="true"
          aria-controls="articlesMenu"
        >
          <span class="ic"><i class="bi bi-file-earmark-text"></i></span>
          <span class="label flex-grow-1">My Articles</span>
          <i class="bi bi-chevron-down ms-auto" style="color: rgba(31,42,51,.55)"></i>
        </button>

        <div class="collapse show" id="articlesMenu">
          <div class="submenu">
            <a class="" href="all-article.html">All Articles</a>
            <a href="create-article.html">Create Article</a>
          </div>
        </div>

        <a class="nav-pill" href="category.html">
          <span class="ic"><i class="bi bi-tags"></i></span>
          <span class="label flex-grow-1">Categories</span>
        </a>

      </nav>

      <div class="sidebar-footer">
        <div class="divider"></div>

        <!-- âœ… add logout-trigger -->
        <a class="logout-btn logout-trigger" href="#">
          <span class="ic"><i class="bi bi-box-arrow-right"></i></span>
          <span class="label">Logout</span>
        </a>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main">
      <!-- TOPBAR -->
      <div class="topbar">
        <div class="title-wrap">
          <button class="hamburger" type="button" id="btnToggleSidebar" aria-label="Toggle sidebar">
            <i class="bi bi-list"></i>
          </button>
          <h1 class="page-title">All Articles</h1>
        </div>

        <!-- Profile dropdown -->
        <div class="dropdown">
          <button
            class="btn profile-pill dropdown-toggle d-flex align-items-center gap-2"
            type="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <img class="avatar" src="." alt="avatar" id="avatarUser">
            <span class="fw-bold" id="profileUser">User Admin</span>
          </button>

          <ul class="dropdown-menu dropdown-menu-end shadow border-0" style="border-radius: 16px; overflow:hidden;">
            <li>
              <a class="dropdown-item py-2" href="profile.html">
                <i class="bi bi-person me-2"></i> Profile
              </a>
            </li>
            <li><hr class="dropdown-divider my-1"></li>
            <li>
              <!-- âœ… add logout-trigger -->
              <a class="dropdown-item py-2 text-danger logout-trigger" href="#">
                <i class="bi bi-box-arrow-right me-2"></i> Logout
              </a>
            </li>
          </ul>
        </div>
      </div>

      <!-- CONTENT -->
      <section class="content-surface">

  <div class="pro-wrap">

    <!-- Header card -->
    <div class="pro-card">
      <div class="pro-top">
        <!-- Avatar -->
       <div class="pro-avatar-wrap">
  <div class="pro-avatar">
    <img id="avatarImg" src="." alt="avatar">
  </div>

 <button class="pro-ic pro-del" id="btnDelAvatar" title="Remove photo">
    <i class="bi bi-trash"></i>
</button>

  <label class="pro-ic pro-up" for="avatarInput" title="Upload photo">
    <i class="bi bi-camera"></i>
  </label>

  <input id="avatarInput" type="file" accept="image/*" hidden>
</div>

        <!-- Name / Email -->
        <div class="pro-id">
          <h2 class="pro-name" id="displayName">Kon Khmer</h2>
          <div class="pro-email" id="displayEmail">konkhmer168@gmail.com</div>
          <div class="pro-hint">Profile picture saves automatically</div>
        </div>

        <!-- Button -->
        <div class="pro-actions">
          <button class="btn pro-btn" id="btnEdit" onclick="btnedit()" type="button">
            <i class="bi bi-pencil-square me-2"></i> Edit Profile
          </button>
        </div>
      </div>

      <!-- Form -->
      <form id="profileForm" class="pro-form" autocomplete="off">
        <div class="row g-3">
          <div class="col-12 col-lg-6">
            <label class="form-label fw-bold">First Name</label>
            <input id="firstName" class="form-control formP" type="text" value="Kon" disabled>
          </div>

          <div class="col-12 col-lg-6">
            <label class="form-label fw-bold">Last Name</label>
            <input id="lastName" class="form-control formP" type="text" value="Khmer" disabled>
          </div>

          <div class="col-12">
            <label class="form-label fw-bold">Email</label>
            <input id="email" class="form-control formP" type="email" value="konkhmer168@gmail.com" disabled>
          </div>
        </div>

        <div class="pro-form-actions" id="saveRow" style="display:none;">
          <button class="btn btn-light px-4" type="button" id="btnCancel">Cancel</button>
          <button class="btn pro-btn-save px-4" type="submit" id="btnSave">
            <i class="bi bi-check2-circle me-2"></i> Save Changes
          </button>
        </div>
      </form>

    </div>

  </div>

</section>
    </main>
  </div><!-- /app -->

  <!-- âœ… Logout Confirm Modal (MUST be outside grid/section) -->
  <div class="modal fade" id="logoutModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow" style="border-radius:18px;">
        <div class="modal-body text-center p-4">
          <div class="mb-2" style="font-size:48px; color:#e53935;">
            <i class="bi bi-box-arrow-right"></i>
          </div>

          <h5 class="fw-bold mb-2">Are you sure?</h5>
          <p class="text-muted mb-4">Do you want to logout from the system?</p>

          <div class="d-flex justify-content-center gap-3">
            <button class="btn btn-light px-4" data-bs-dismiss="modal">Cancel</button>
            <a href="../index.html" class="btn btn-danger px-4" id="confirmLogout">Logout</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../asset/js/dashboard.js"></script>
  <script src="../asset/js/script.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
 <script>
 
// --- áž€áž¶ážšáž€áŸ†ážŽážáŸ‹ API ---
const API_BASE_URL = 'https://blogs2.csm.linkpc.net/api/v1';
const Token = localStorage.getItem("token");

const headers = {
    'Authorization': `Bearer ${Token}`,
    'Accept': 'application/json'
};

// --- áž…áž¶áž”áŸ‹áž™áž€ Elements (áž”áž“áŸ’ážáŸ‚áž˜áž€áž¶ážšáž†áŸ‚áž€ Null ážŠáž¾áž˜áŸ’áž”áž¸áž€áž¶ážšáž–áž¶ážš error) ---
const avatarImg = document.getElementById("avatarImg");
const avatarInput = document.getElementById("avatarInput");
const displayName = document.getElementById("displayName");
const displayEmail = document.getElementById("displayEmail");

// áŸ¡. áž˜áž»ážáž„áž¶ážšáž‘áž¶áž‰áž‘áž·áž“áŸ’áž“áž“áŸáž™ Profile (GET /auth/profile)
async function fetchProfile() {
    try {
        const res = await fetch(`${API_BASE_URL}/auth/profile`, { 
            method: 'GET', 
            headers: headers 
        });
        
        const result = await res.json();
        if (res.ok && result.data) {
            const user = result.data;
            
            // áž”áž„áŸ’áž áž¶áž‰áž›áž¾ Header (ážŠáž¼áž…áž€áŸ’áž“áž»áž„ážšáž¼áž”áž—áž¶áž– siv punleu)
            if(displayName) displayName.textContent = `${user.firstName} ${user.lastName}`;
            if(displayEmail) displayEmail.textContent = user.email;
            
            // áž”áŸ†áž–áŸáž‰áž€áŸ’áž“áž»áž„ Form (Kon Khmer)
            if(document.getElementById('firstName')) document.getElementById('firstName').value = user.firstName;
            if(document.getElementById('lastName')) document.getElementById('lastName').value = user.lastName;
            if(document.getElementById('email')) document.getElementById('email').value = user.email;

            // áž”áž„áŸ’áž áž¶áž‰ážšáž¼áž”áž—áž¶áž–
            if(user.avatar && avatarImg) avatarImg.src = user.avatar;
        }
    } catch (err) { console.error("Fetch Error:", err); }
}

avatarInput.addEventListener("change", () => {
  //https://blogs2.csm.linkpc.net/api/v1/auth/profile/avatar
  const file = avatarInput.files[0];
  const formData = new FormData();
  formData.append("avatar", file);

  fetch(`${API_BASE_URL}/profile/avatar`, {
    method: "POST",
    headers: headers,
    body: formData
  })
  .then(res => res.json())
  .then(data => {
    if (data.ok && data.data) {
      const user = data.data;
      if(user.avatar && avatarImg) avatarImg.src = user.avatar;
    }
  })
  .catch(err => console.error("Fetch Error:", err));
});
//logout



 
  








// áž…áž¶áž”áŸ‹áž•áŸ’ážŠáž¾áž˜ážŠáŸ†ážŽáž¾ážšáž€áž¶ážš
window.onload = fetchProfile;

 </script>
</body>
</html>